<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weapon regeX</title>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <style>
        .mutant-container {
            background-color: ghostwhite;
            padding: 1em;
            border-radius: .25rem;
        }

        .mutant {
            padding: 0.25em 0em;
            color: black;
        }

        .mut-pre {
            display: inline-block;
        }

        .mut-rem {
            display: inline-block;
            color: red;
            text-decoration: line-through;
        }

        .mut-add {
            display: inline-block;
            color: green;
        }

        .mut-pos {
            display: inline-block;
        }

    </style>
</head>
<body>
<!-- Include Scala.js compiled code -->
<script type="text/javascript" src="../shared/target/js-2.13/weapon-regex-fastopt/main.js"></script>
<script
			  src="https://code.jquery.com/jquery-3.5.1.min.js"
			  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
			  crossorigin="anonymous"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js"></script>

<div style="width: 50vw; height: 50vh; margin: 10% auto;">
    <h1>W<font style="font-variant: small-caps">eapon rege</font>X</h1>

    <form>
        <div class="form-group">
            <label for="inputPattern">Regex pattern</label>
            <div class="input-group">
                <input type="text" value="^asdf$" class="form-control" id="inputPattern" required>
                <div class="input-group-append">
                    <button type="button" class="btn btn-primary" onclick="runMutator()">Mutate</button>
                </div>
            </div>
            <label for="inputPattern">Mutation level</label>
            <div class="input-group">
                <input type="text" value="3" class="form-control" id="inputLevel" required>
            </div>
        </div>

        <div class="form-group">
            <label for="mutants">Mutants</label>
            <div class="mutant-container" id="mutants" rows="10" readonly></div>
        </div>

        <script>
            input = document.getElementById('inputPattern');
            output = document.getElementById('mutants');
            level = document.getElementById('inputLevel');
            counter = 0;

            function runMutator() {
                output.innerHTML = ''
                WeaponRegeX = $m_Lweaponregex_WeaponRegeX$()
                mutants = WeaponRegeX.mutate(input.value, parseInt(level.value));
                console.log(mutants);
                processMutantList(mutants, input.value);
            }

            function processMutantList(list, orig) {
                processMutant(list.sci_$colon$colon__f_head, orig);
                processMutantList(list.sci_$colon$colon__f_next, orig);
            }

            function processMutant(mutant, orig) {
                mutatorStart = mutant.data.location.start.column;
                mutatorEnd = mutant.data.location.end.column;
                lengthDiff = mutant.pattern.length - orig.length;
                pre = orig.substr(0, mutatorStart);
                removed = orig.substr(mutatorStart, mutatorEnd - mutatorStart);
                added = mutant.pattern.substr(mutatorStart, mutatorEnd - mutatorStart + lengthDiff);
                post = orig.substr(mutatorEnd)
                console.log(pre)
                output.innerHTML = output.innerHTML + `
<div class="mutant"><a class="mutant" href="#mutDescr` + counter + `" data-toggle="collapse">` + mutant.pattern + `</a>
    <div id="mutDescr` + counter + `" class="collapse">
        <div class="card card-body">
            <p>
                <span class="mut-pre">` + pre + `</span><span class="mut-rem">` + removed + `</span><span class="mut-add">` + added + `</span><span class="mut-pos">` + post + `</span><br>
            </p>` + mutant.data.name + ` (Level: ` + mutant.data.level + `)<br>
                ` + mutant.data.description + `
        </div>
    </div>
</div>`
                counter++;
            }
        </script>
    </form>
</div>

</body>
</html>